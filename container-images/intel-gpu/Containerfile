FROM quay.io/fedora/fedora:43 as builder

COPY container-images/intel-gpu/oneAPI.repo /etc/yum.repos.d/
COPY container-images/scripts/build_llama.sh \
     container-images/scripts/lib.sh \
     /src/
WORKDIR /src/
RUN ./build_llama.sh intel-gpu

FROM quay.io/fedora/fedora:43

RUN --mount=type=bind,from=builder,source=/tmp/install,target=/tmp/install \
    cp -a /tmp/install/bin/ /usr/ && \
    cp -a /tmp/install/lib64/*.so* /usr/lib64/
COPY container-images/intel-gpu/oneAPI.repo /etc/yum.repos.d/
RUN --mount=type=bind,target=/src \
    /src/container-images/scripts/build_llama.sh intel-gpu runtime

COPY --chmod=755 container-images/intel-gpu/entrypoint.sh /usr/bin/

ENTRYPOINT ["/usr/bin/entrypoint.sh"]
